<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="心宿, 米粒工作室, 昊天兽王, 心率广播网站, 心率监测, 蓝牙心率, 心电图, QRS脉冲">
    <meta name="description" content="心宿心率广播网站 - 实时蓝牙心率监测与视觉化反馈，米粒工作室 & 昊天兽王 出品。">
    <meta name="author" content="米粒工作室 & 昊天兽王">
    <title>心宿 · 心率检测</title>
    <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
      }
    }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="style1 light-mode">
    <!-- 3D背景容器 -->
    <div id="canvas-container"></div>
    
    <!-- 警报覆盖层 -->
    <div class="alarm-overlay" id="alarmOverlay"></div>

    <!-- 顶部控制栏 -->
    <header class="top-bar">
        <div class="brand">
            <div class="logo">心宿</div>
            <div class="status-indicator" id="statusIndicator" title="未连接">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">未连接</span>
            </div>
        </div>
        
        <div class="controls">
            <div class="sound-control">
                <span class="sound-label">音效</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="audioToggle">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <button class="connect-btn" id="connectBtn">连接设备</button>
            <button class="connect-btn" id="settingsBtn">设置</button>
        </div>
    </header>

    <!-- 主内容 -->
    <main class="main-content">
        <!-- 心率显示 -->
        <section class="heart-rate-section">
            <div class="heart-rate-display">
                <span id="bpm-display">--</span><span id="bpm-unit">次/分</span>
            </div>
        </section>

        <!-- ECG 显示 -->
        <section class="ecg-section">
            <div class="ecg-wrapper">
                <div class="ecg-grid"></div>
                <canvas id="ecg-canvas"></canvas>
            </div>
        </section>
    </main>

    <!-- 底部详细信息 -->
    <footer class="footer">
        <div class="footer-content">
            <div class="warning-info">
                警告：心电图像是心率模拟结果，仅供娱乐，切勿代替医疗器械
            </div>
            <div class="footer-info">
                <a href="https://昊天兽王.top" target="_blank">昊天兽王</a> | 
                <a href="https://milir.top/" target="_blank">milirstudio</a> | 
                <a href="https://github.com/haotianshouwang/xinsu" target="_blank">心宿 GitHub</a> | 
                <a href="https://beian.miit.gov.cn/" target="_blank">备-xxxxxxxxxxxx</a>
            </div>
        </div>
    </footer>

    <!-- 设置面板 -->
    <div id="settings-panel" class="settings-panel">
        <div class="settings-header">
            <h3>设置中心</h3>
            <div class="settings-header-actions">
                <button class="settings-btn-icon" id="resetSettingsBtn" title="重置为默认设置">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21.5 2v6h-6M2.5 22v-6h6"/>
                        <path d="M2 11.5a10 10 0 0 1 18.8-4.3"/>
                        <path d="M22 12.5a10 10 0 0 1-18.8 4.2"/>
                    </svg>
                </button>
                <button class="settings-btn-icon" id="closeSettingsBtn" title="关闭设置">×</button>
            </div>
        </div>
        <div class="settings-container">
            <!-- 设置导航 -->
            <div class="settings-nav">
                <button class="settings-nav-item active" data-section="appearance">外观设置</button>
                <button class="settings-nav-item" data-section="display">显示设置</button>
                <button class="settings-nav-item" data-section="effects">视觉效果</button>
                <button class="settings-nav-item" data-section="heart-rate">心率监测</button>
                <button class="settings-nav-item" data-section="ecg">心电图设置</button>
                <button class="settings-nav-item" data-section="audio">音频设置</button>
                <button class="settings-nav-item" data-section="system">系统设置</button>
            </div>
            <!-- 设置内容 -->
            <div class="settings-content">
                <!-- 外观设置 -->
                <div class="settings-section" id="appearance-section">
                    <h4>外观设置</h4>
                    <div class="settings-group">
                        <label class="settings-label">主题模式</label>
                        <div class="theme-mode-options">
                            <div class="theme-mode-option">
                                <input type="radio" id="theme-light" name="theme-mode" value="light" checked>
                                <label for="theme-light">
                                    <div class="theme-preview light-preview"></div>
                                    <span>浅色模式</span>
                                </label>
                            </div>
                            <div class="theme-mode-option">
                                <input type="radio" id="theme-dark" name="theme-mode" value="dark">
                                <label for="theme-dark">
                                    <div class="theme-preview dark-preview"></div>
                                    <span>深色模式</span>
                                </label>
                            </div>
                            <div class="theme-mode-option">
                                <input type="radio" id="theme-auto" name="theme-mode" value="auto">
                                <label for="theme-auto">
                                    <div class="theme-preview auto-preview"></div>
                                    <span>自动模式</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">主色调</label>
                        <div class="color-picker-group">
                            <input type="color" id="themeColor" value="#ff0033" class="color-picker">
                            <div class="color-presets">
                                <button class="color-preset" data-color="#ff0033"></button>
                                <button class="color-preset" data-color="#007bff"></button>
                                <button class="color-preset" data-color="#28a745"></button>
                                <button class="color-preset" data-color="#ffc107"></button>
                                <button class="color-preset" data-color="#6f42c1"></button>
                            </div>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="footerToggle" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">显示页脚信息</span>
                        </label>
                    </div>
                </div>

                <!-- 显示设置 -->
                <div class="settings-section" id="display-section" style="display: none;">
                    <h4>显示设置</h4>
                    <div class="settings-group">
                        <label class="settings-label">背景设置</label>
                        <div class="bg-type-options">
                            <label class="bg-type-option">
                                <input type="radio" name="bg-type" value="color">
                                <span>纯色背景</span>
                            </label>
                            <label class="bg-type-option">
                                <input type="radio" name="bg-type" value="image" checked>
                                <span>图片背景</span>
                            </label>
                        </div>
                    </div>
                    <div class="settings-group bg-color-group">
                        <label class="settings-label">背景颜色</label>
                        <input type="color" id="bgColorPicker" value="#000000" class="color-picker">
                    </div>
                    <div class="settings-group bg-image-group">
                        <label class="settings-label">背景图片</label>
                        <div class="bg-image-controls">
                            <input type="text" id="bgImageUrl" placeholder="输入图片URL" class="url-input">
                            <input type="file" id="bgImageUpload" accept="image/*" style="display: none;">
                            <button class="settings-btn" id="uploadBtn" onclick="document.getElementById('bgImageUpload').click()">上传本地图片</button>
                        </div>
                        <div class="wallpaper-grid" id="wallpaperGrid"></div>
                    </div>
                </div>

                <!-- 视觉效果 -->
                <div class="settings-section" id="effects-section" style="display: none;">
                    <h4>视觉效果</h4>
                    <div class="settings-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="particlesToggle" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">启用粒子效果</span>
                        </label>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">粒子效果类型</label>
                        <div class="particle-effect-container">
                            <select id="particlesEffect" class="settings-select short">
                                <option value="标准">标准</option>
                                <option value="星空1" selected>星空1</option>
                                <option value="原始星空">原始星空</option>
                                <option value="律动星空">律动星空</option>
                                <option value="星云">星云</option>
                                <option value="银河">银河</option>
                                <option value="极光">极光</option>
                                <option value="脉冲">脉冲</option>
                                <option value="波浪">波浪</option>
                                <option value="呼吸粒子">呼吸粒子</option>
                                <option value="萤火虫">萤火虫</option>
                                <option value="暴风雪">暴风雪</option>
                                <option value="原始粒子云">原始粒子云</option>
                            </select>
                            <div class="particle-preview" id="particlePreview">
                                <div class="preview-label">效果预览</div>
                                <div class="preview-container" id="previewContainer"></div>
                            </div>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">粒子颜色</label>
                        <div class="particle-color-controls">
                            <input type="color" id="particlesColor" value="#ffffff" class="color-picker">
                            <div class="particle-color-presets" id="particleColorPresets"></div>
                            <div class="particle-color-additional" id="particleColorAdditional" style="display: none;"></div>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">粒子数量</label>
                        <div class="range-control">
                            <input type="range" id="particlesCount" min="500" max="5000" value="2000" step="100" class="range-slider">
                            <input type="number" id="particlesCountInput" min="500" max="5000" value="2000" step="100" class="range-input">
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">粒子大小</label>
                        <div class="range-control">
                            <input type="range" id="particlesSize" min="0.1" max="2" value="0.5" step="0.1" class="range-slider">
                            <input type="number" id="particlesSizeInput" min="0.1" max="2" value="0.5" step="0.1" class="range-input">
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">效果与心率绑定</label>
                        <div class="effect-heart-rate-controls">
                            <label class="toggle-switch">
                                <input type="checkbox" id="effectHeartRateToggle" checked>
                                <span class="toggle-slider"></span>
                                <span class="toggle-label">启用心率绑定</span>
                            </label>
                            <div class="settings-group" style="margin-top: 12px;">
                                <label class="settings-label">绑定强度</label>
                                <div class="range-control">
                                    <input type="range" id="effectHeartRateIntensity" min="0.1" max="2" value="1" step="0.1" class="range-slider">
                                    <input type="number" id="effectHeartRateIntensityInput" min="0.1" max="2" value="1" step="0.1" class="range-input">
                                </div>
                            </div>
                            <div class="settings-group" style="margin-top: 12px;">
                                <label class="settings-label">触发模式</label>
                                <select id="effectHeartRateMode" class="settings-select">
                                    <option value="pulse">心跳脉冲</option>
                                    <option value="bpm">心率区间</option>
                                    <option value="constant">持续效果</option>
                                </select>
                            </div>
                            <div class="settings-group" style="margin-top: 12px;">
                                <label class="settings-label">心率区间效果</label>
                                <div class="heart-rate-ranges">
                                    <div class="range-item">
                                        <span class="range-label">低心率 (< 60 BPM)</span>
                                        <select id="lowBpmEffect" class="settings-select">
                                                <option value="calm">平静模式</option>
                                                <option value="normal">标准模式</option>
                                            </select>
                                    </div>
                                    <div class="range-item">
                                        <span class="range-label">正常心率 (60-100 BPM)</span>
                                        <select id="normalBpmEffect" class="settings-select">
                                                <option value="normal">标准模式</option>
                                                <option value="calm">平静模式</option>
                                                <option value="energetic">活力模式</option>
                                            </select>
                                    </div>
                                    <div class="range-item">
                                        <span class="range-label">高心率 (> 100 BPM)</span>
                                        <select id="highBpmEffect" class="settings-select">
                                                <option value="alert">警告模式</option>
                                                <option value="energetic">活力模式</option>
                                            </select>
                                    </div>
                                </div>
                            </div>
                            <div class="settings-group" style="margin-top: 12px;">
                                <label class="settings-label">发光效果</label>
                                <div class="glow-settings">
                                    <div class="glow-setting-item">
                                        <label class="toggle-switch">
                                            <input type="checkbox" id="glowEffectToggle" checked>
                                            <span class="toggle-slider"></span>
                                            <span class="toggle-label">发光效果</span>
                                        </label>
                                    </div>
                                    <div class="glow-setting-item" style="margin-top: 8px;">
                                        <span class="range-label">发光颜色</span>
                                        <input type="color" id="glowColorPicker" value="#ff0000" class="color-picker">
                                    </div>
                                    <div class="glow-setting-item" style="margin-top: 8px;">
                                        <span class="range-label">发光强度</span>
                                        <div class="range-control">
                                            <input type="range" id="glowIntensity" min="0.1" max="5" value="2" step="0.1" class="range-slider">
                                            <input type="number" id="glowIntensityInput" min="0.1" max="5" value="2" step="0.1" class="range-input">
                                        </div>
                                    </div>
                                    <div class="glow-setting-item" style="margin-top: 8px;">
                                        <span class="range-label">发光模式</span>
                                        <select id="glowModeSelect" class="settings-select">
                                            <option value="all">整体</option>
                                            <option value="partial">部分</option>
                                            <option value="random">随机</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- 心率监测 -->
                <div class="settings-section" id="heart-rate-section" style="display: none;">
                    <h4>心率监测</h4>
                    <div class="settings-group">
                        <label class="settings-label">显示位置</label>
                        <div class="position-grid">
                            <label class="position-option">
                                <input type="radio" name="hr-position" value="center">
                                <span>居中</span>
                            </label>
                            <label class="position-option">
                                <input type="radio" name="hr-position" value="left" checked>
                                <span>左侧</span>
                            </label>
                            <label class="position-option">
                                <input type="radio" name="hr-position" value="right">
                                <span>右侧</span>
                            </label>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">显示样式</label>
                        <div class="style-options">
                            <label class="style-option">
                                <input type="radio" name="hr-style" value="digital" checked>
                                <span>数字显示</span>
                            </label>
                            <label class="style-option">
                                <input type="radio" name="hr-style" value="analog">
                                <span>模拟表盘</span>
                            </label>
                            <label class="style-option">
                                <input type="radio" name="hr-style" value="3d">
                                <span>3D效果</span>
                            </label>
                            <label class="style-option">
                                <input type="radio" name="hr-style" value="pulse">
                                <span>脉冲效果</span>
                            </label>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">显示颜色</label>
                        <input type="color" id="heartRateColor" value="#ff0033" class="color-picker">
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">字体大小</label>
                        <div class="range-control">
                            <input type="range" id="heartRateSize" min="40" max="200" value="100" step="10" class="range-slider">
                            <span class="range-value">100px</span>
                        </div>
                    </div>
                </div>
                
                <!-- 心电图设置 -->
                <div class="settings-section" id="ecg-section" style="display: none;">
                    <h4>心电图设置</h4>
                    <div class="settings-group">
                        <label class="settings-label">网格设置</label>
                        <div class="ecg-grid-controls">
                            <div class="grid-control-item">
                                <label class="sub-label">网格颜色</label>
                                <input type="color" id="ecgGridColor" value="#ffff00" class="color-picker small">
                            </div>
                            <div class="grid-control-item">
                                <label class="sub-label">网格透明度</label>
                                <div class="range-control">
                                    <input type="range" id="ecgGridOpacity" min="0" max="1" value="0.1" step="0.01" class="range-slider">
                                    <span id="ecgGridOpacityValue" class="range-value">0.1</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">波形设置</label>
                        <div class="wave-control-item">
                            <label class="sub-label">线条颜色</label>
                            <input type="color" id="ecgLineColor" value="#ff0033" class="color-picker small">
                        </div>
                        <div class="wave-control-item">
                            <label class="sub-label">线条宽度</label>
                            <div class="range-control">
                                <input type="range" id="ecgLineWidth" min="1" max="5" value="2" step="0.5" class="range-slider">
                                <span id="ecgLineWidthValue" class="range-value">2</span>
                            </div>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">波形参数</label>
                        <div class="wave-params">
                            <div class="param-item">
                                <label class="sub-label">P波幅度</label>
                                <div class="range-control">
                                    <input type="range" id="ecgPWave" min="0" max="0.3" value="0.15" step="0.01" class="range-slider">
                                    <span id="ecgPWaveValue" class="range-value">0.15</span>
                                </div>
                            </div>
                            <div class="param-item">
                                <label class="sub-label">Q波幅度</label>
                                <div class="range-control">
                                    <input type="range" id="ecgQWave" min="-0.4" max="0" value="-0.1" step="0.01" class="range-slider">
                                    <span id="ecgQWaveValue" class="range-value">-0.1</span>
                                </div>
                            </div>
                            <div class="param-item">
                                <label class="sub-label">R波幅度</label>
                                <div class="range-control">
                                    <input type="range" id="ecgRWave" min="0" max="1" value="0.8" step="0.01" class="range-slider">
                                    <span id="ecgRWaveValue" class="range-value">0.8</span>
                                </div>
                            </div>
                            <div class="param-item">
                                <label class="sub-label">S波幅度</label>
                                <div class="range-control">
                                    <input type="range" id="ecgSWave" min="-0.4" max="0" value="-0.2" step="0.01" class="range-slider">
                                    <span id="ecgSWaveValue" class="range-value">-0.2</span>
                                </div>
                            </div>
                            <div class="param-item">
                                <label class="sub-label">T波幅度</label>
                                <div class="range-control">
                                    <input type="range" id="ecgTWave" min="-0.3" max="0.4" value="0.25" step="0.01" class="range-slider">
                                    <span id="ecgTWaveValue" class="range-value">0.25</span>
                                </div>
                            </div>
                            <div class="param-item">
                                <label class="sub-label">抖动强度</label>
                                <div class="range-control">
                                    <input type="range" id="ecgJitter" min="0" max="0.3" value="0.05" step="0.01" class="range-slider">
                                    <span id="ecgJitterValue" class="range-value">0.05</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">预设模板</label>
                        <select id="ecgPreset" class="settings-select">
                            <option value="默认" selected>默认</option>
                            <option value="正常">正常心电图</option>
                            <option value="心肌梗塞">心肌梗塞模拟</option>
                            <option value="干扰">干扰信号模拟</option>
                        </select>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">显示效果</label>
                        <select id="ecgEffect" class="settings-select">
                            <option value="标准" selected>标准</option>
                            <option value="科技感">科技感</option>
                            <option value="极简">极简</option>
                            <option value="复古">复古</option>
                        </select>
                    </div>
                    <div class="settings-group">
                        <button class="settings-btn primary" id="ecgRandomBtn">随机生成参数</button>
                    </div>
                </div>
                
                <!-- 音频设置 -->
                <div class="settings-section" id="audio-section" style="display: none;">
                    <h4>音频设置</h4>
                    <div class="settings-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="audioToggleSetting" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">启用音效</span>
                        </label>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">音效类型</label>
                        <select class="settings-select">
                            <option value="standard" selected>标准心跳声</option>
                            <option value="digital">数字音效</option>
                            <option value="ambient">环境音效</option>
                            <option value="none">静音</option>
                        </select>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">音量</label>
                        <div class="range-control">
                            <input type="range" min="0" max="100" value="70" step="5" class="range-slider">
                            <span class="range-value">70%</span>
                        </div>
                    </div>
                </div>
                
                <!-- 系统设置 -->
                <div class="settings-section" id="system-section" style="display: none;">
                    <h4>系统设置</h4>
                    <div class="settings-group">
                        <label class="settings-label">日志级别</label>
                        <select id="logLevelSelect" class="settings-select">
                            <option value="none">关闭</option>
                            <option value="basic" selected>基本</option>
                            <option value="detailed">详细</option>
                        </select>
                    </div>
                    <div class="settings-group">
                        <label class="toggle-switch">
                            <input type="checkbox" id="logDisplay">
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">显示日志面板</span>
                        </label>
                    </div>
                    <div class="settings-group">
                        <label class="toggle-switch">
                            <input type="checkbox" checked>
                            <span class="toggle-slider"></span>
                            <span class="toggle-label">启用心率警报</span>
                        </label>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">心率警报阈值</label>
                        <div class="threshold-controls">
                            <div class="threshold-item">
                                <label class="sub-label">最低心率</label>
                                <input type="number" min="30" max="200" value="50" class="number-input">
                                <span>次/分</span>
                            </div>
                            <div class="threshold-item">
                                <label class="sub-label">最高心率</label>
                                <input type="number" min="30" max="200" value="180" class="number-input">
                                <span>次/分</span>
                            </div>
                        </div>
                    </div>
                    <div class="settings-group">
                        <button class="settings-btn danger">重置所有设置</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 日志显示面板 -->
    <div id="log-panel" class="log-panel">
        <div class="log-header">
            <h4>日志</h4>
            <div class="log-controls">
                <button id="clearLogBtn">清空</button>
                <button id="pinLogBtn">📎</button>
                <button id="closeLogBtn">×</button>
            </div>
        </div>
        <div class="log-content" id="logContent"></div>
    </div>

    <script type="module" src="main.js"></script>
</body>
</html>