<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="心宿, 米粒工作室, 昊天兽王, 心率广播网站, 心率监测, 蓝牙心率, 心电图, QRS脉冲">
    <meta name="description" content="心宿心率广播网站 - 实时蓝牙心率监测与视觉化反馈，米粒工作室 & 昊天兽王 出品。">
    <meta name="author" content="米粒工作室 & 昊天兽王">
    <title>心宿 · 心率检测</title>
    <script type="importmap">
    {
      "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
      }
    }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="style1">
    <!-- 3D背景容器 -->
    <div id="canvas-container"></div>
    
    <!-- 警报覆盖层 -->
    <div class="alarm-overlay" id="alarmOverlay"></div>

    <!-- 样式1：UI层 -->
    <div id="ui-layer" class="style1-only">
        <div class="hud-top-left">
            <h1>警告：心电图像是心率模拟结果，仅供娱乐，切勿代替医疗器械</h1>
            <div id="bpm-wrapper">
                <span id="bpm-display">--</span><span id="bpm-unit">次/分</span>
            </div>
            
            <div class="controls">
                <button id="connectBtn">连接设备</button>
                <button class="style-toggle-btn" onclick="toggleStyle()">换个样式</button>
                <button id="settingsBtn">设置</button>
                <div class="toggle-switch">
                    <span class="toggle-label">音频反馈</span>
                    <label class="switch">
                        <input type="checkbox" id="audioToggle">
                        <span class="slider"></span>
                    </label>
                </div>
            </div>
        </div>

        <div class="status-bar">
            系统状态: <span id="connection-status">未连接</span>
        </div>
    </div>

    <!-- 样式1：ECG容器 -->
    <div id="ecg-container" class="style1-only">
        <canvas id="ecg-canvas-style1"></canvas>
    </div>

    <!-- 样式2：顶部控制栏 -->
    <header class="top-bar style2-only">
        <div class="brand">
            <div class="logo">心宿</div>
            <div class="status-indicator">
                <span class="status-dot" id="statusDot"></span>
                <span id="statusText">未连接</span>
            </div>
        </div>
        
        <div class="controls">
            <div class="sound-control">
                <span class="sound-label">音效</span>
                <label class="toggle-switch">
                    <input type="checkbox" id="soundToggle">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            <button class="connect-btn" id="connectBtn2">连接设备</button>
            <button class="connect-btn" id="settingsBtn2">设置</button>
            <button class="connect-btn style-toggle-btn" onclick="toggleStyle()">换个样式</button>
        </div>
    </header>

    <!-- 样式2：主内容 -->
    <main class="main-content style2-only">
        <!-- 心率显示 -->
        <section class="heart-rate-section">
            <div class="heart-rate-display">
                <div class="heart-rate-value" id="heartRate">--</div>
                <div class="heart-rate-unit">BPM</div>
            </div>
        </section>

        <!-- ECG 显示 -->
        <section class="ecg-section">
            <div class="ecg-label">警告：心电图像是心率模拟结果，仅供娱乐，切勿代替医疗器械</div>
            <div class="ecg-wrapper">
                <div class="ecg-grid"></div>
                <canvas id="ecg-canvas-style2"></canvas>
            </div>
        </section>

        <!-- 调试面板 -->
        <section class="debug-panel">
            <div class="debug-header">
                <span class="debug-title">数据包调试</span>
                <span class="debug-count" id="debugCount">0 packets</span>
            </div>
            <div class="debug-content" id="debugContent">
                <div class="debug-line">
                    <span class="debug-time">--:--:--</span>
                    <span class="debug-type">WAIT</span>
                    <span class="debug-data">等待设备连接...</span>
                </div>
            </div>
        </section>
    </main>

    <!-- 设置面板 -->
    <div id="settings-panel" class="settings-panel">
        <div class="settings-header">
            <h3>设置</h3>
            <button id="closeSettingsBtn">×</button>
        </div>
        <div class="settings-content">
            <!-- 日志设置 -->
            <div class="settings-section">
                <h4>日志设置</h4>
                <div class="settings-group">
                    <label class="settings-label">日志级别</label>
                    <select id="logLevelSelect">
                        <option value="none">关闭</option>
                        <option value="basic">基本</option>
                        <option value="detailed">详细</option>
                    </select>
                </div>
                <div class="settings-group">
                    <label class="module-log-item">
                        <input type="checkbox" id="logDisplay" checked>
                        <span>显示日志面板</span>
                    </label>
                </div>
                <div class="settings-group">
                    <label class="settings-label">模块日志</label>
                    <div class="module-logs">
                        <label class="module-log-item">
                            <input type="checkbox" id="logBluetooth" checked>
                            <span>蓝牙模块</span>
                        </label>
                        <label class="module-log-item">
                            <input type="checkbox" id="logAudio" checked>
                            <span>音频模块</span>
                        </label>
                        <label class="module-log-item">
                            <input type="checkbox" id="logECG" checked>
                            <span>ECG模块</span>
                        </label>
                        <label class="module-log-item">
                            <input type="checkbox" id="logThree" checked>
                            <span>Three.js模块</span>
                        </label>
                        <label class="module-log-item">
                            <input type="checkbox" id="logStyle" checked>
                            <span>样式模块</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 日志显示面板 -->
    <div id="log-panel" class="log-panel">
        <div class="log-header">
            <h4>日志</h4>
            <button id="clearLogBtn">清空</button>
        </div>
        <div class="log-content" id="logContent"></div>
    </div>

    <script type="module" src="main.js"></script>
</body>
</html>